package com.snb.deal.service.impl.plan;

import com.jianlc.tc.guid.GuidCreater;
import com.snb.BaseBeanTest;
import com.snb.common.enums.FundChannelEnum;
import com.snb.deal.api.dto.plan.portfolio.PortfolioAccountRequest;
import com.snb.deal.entity.plan.PlanInfoDO;
import com.snb.deal.service.plan.PlanService;
import com.snb.fund.api.dto.mainmodel.FundMainModelDTO;
import org.apache.commons.collections.CollectionUtils;
import org.joda.time.DateTime;
import org.junit.Assert;
import org.junit.Test;

import javax.annotation.Resource;
import java.util.Date;
import java.util.List;

public class PlanServiceImplTest extends BaseBeanTest{

    @Resource
    PlanService planService;
    @Resource
    GuidCreater guidCreater;

    @Test
    public void testPageInfo() {
        List<PlanInfoDO> planInfoDOList = planService.pagePlanInfo(0,1000);
        System.out.println(planInfoDOList);
    }

    @Test
    public void afterPlanCreated() throws Exception {

        PlanInfoDO planInfoDO = new PlanInfoDO();
        planInfoDO.setUserId("15e642dc00c645d6b9c5b0a613e64e9a");
        planInfoDO.setPlanInfoId(40221190754368L);
        planInfoDO.setNextRunDate(new Date());
        planInfoDO.setThirdPlanId(213212+"");
        planInfoDO.setChannel(1);

        FundMainModelDTO fundMainModelDTO = new FundMainModelDTO();
        fundMainModelDTO.setFundMainModelId(1L);
        planService.afterPlanCreated(planInfoDO,fundMainModelDTO,"");
    }

    @Test
    public void queryPortfolioAccount() throws Exception {

        PortfolioAccountRequest request = new PortfolioAccountRequest();

        request.setUserId("05c2edb8a6cb41e4911889019ae2973e");
        request.setPlanId(43481926324224L);
        request.setAccountNumber("JLC20180508000027760");
        request.setChannel(FundChannelEnum.YIFENG);
        request.setThirdPortfolioId("986969");

//        planService.queryPortfolioAccountFromThird(request);

        String d = "2017-03-29\n" +
                "2017-03-30\n" +
                "2017-03-31\n" +
                "2017-04-05\n" +
                "2017-04-06\n" +
                "2017-04-07\n" +
                "2017-04-10\n" +
                "2017-04-11\n" +
                "2017-04-12\n" +
                "2017-04-13\n" +
                "2017-04-14\n" +
                "2017-04-17\n" +
                "2017-04-18\n" +
                "2017-04-19\n" +
                "2017-04-20\n" +
                "2017-04-21\n" +
                "2017-04-24\n" +
                "2017-04-25\n" +
                "2017-04-26\n" +
                "2017-04-27\n" +
                "2017-04-28\n" +
                "2017-05-02\n" +
                "2017-05-03\n" +
                "2017-05-04\n" +
                "2017-05-05\n" +
                "2017-05-08\n" +
                "2017-05-09\n" +
                "2017-05-10\n" +
                "2017-05-11\n" +
                "2017-05-12\n" +
                "2017-05-15\n" +
                "2017-05-16\n" +
                "2017-05-17\n" +
                "2017-05-18\n" +
                "2017-05-19\n" +
                "2017-05-22\n" +
                "2017-05-23\n" +
                "2017-05-24\n" +
                "2017-05-25\n" +
                "2017-05-26\n" +
                "2017-05-31\n" +
                "2017-06-01\n" +
                "2017-06-02\n" +
                "2017-06-05\n" +
                "2017-06-06\n" +
                "2017-06-07\n" +
                "2017-06-08\n" +
                "2017-06-09\n" +
                "2017-06-12\n" +
                "2017-06-13\n" +
                "2017-06-14\n" +
                "2017-06-15\n" +
                "2017-06-16\n" +
                "2017-06-19\n" +
                "2017-06-20\n" +
                "2017-06-21\n" +
                "2017-06-22\n" +
                "2017-06-23\n" +
                "2017-06-26\n" +
                "2017-06-27\n" +
                "2017-06-28\n" +
                "2017-06-29\n" +
                "2017-06-30\n" +
                "2017-07-03\n" +
                "2017-07-04\n" +
                "2017-07-05\n" +
                "2017-07-06\n" +
                "2017-07-07\n" +
                "2017-07-10\n" +
                "2017-07-11\n" +
                "2017-07-12\n" +
                "2017-07-13\n" +
                "2017-07-14\n" +
                "2017-07-17\n" +
                "2017-07-18\n" +
                "2017-07-19\n" +
                "2017-07-20\n" +
                "2017-07-21\n" +
                "2017-07-24\n" +
                "2017-07-25\n" +
                "2017-07-26\n" +
                "2017-07-27\n" +
                "2017-07-28\n" +
                "2017-07-31\n" +
                "2017-08-01\n" +
                "2017-08-02\n" +
                "2017-08-03\n" +
                "2017-08-04\n" +
                "2017-08-07\n" +
                "2017-08-08\n" +
                "2017-08-09\n" +
                "2017-08-10\n" +
                "2017-08-11\n" +
                "2017-08-14\n" +
                "2017-08-15\n" +
                "2017-08-16\n" +
                "2017-08-17\n" +
                "2017-08-18\n" +
                "2017-08-21\n" +
                "2017-08-22\n" +
                "2017-08-23\n" +
                "2017-08-24\n" +
                "2017-08-25\n" +
                "2017-08-28\n" +
                "2017-08-29\n" +
                "2017-08-30\n" +
                "2017-08-31\n" +
                "2017-09-01\n" +
                "2017-09-04\n" +
                "2017-09-05\n" +
                "2017-09-06\n" +
                "2017-09-07\n" +
                "2017-09-08\n" +
                "2017-09-11\n" +
                "2017-09-12\n" +
                "2017-09-13\n" +
                "2017-09-14\n" +
                "2017-09-15\n" +
                "2017-09-18\n" +
                "2017-09-19\n" +
                "2017-09-20\n" +
                "2017-09-21\n" +
                "2017-09-22\n" +
                "2017-09-25\n" +
                "2017-09-26\n" +
                "2017-09-27\n" +
                "2017-09-28\n" +
                "2017-09-29\n" +
                "2017-10-09\n" +
                "2017-10-10\n" +
                "2017-10-11\n" +
                "2017-10-12\n" +
                "2017-10-13\n" +
                "2017-10-16\n" +
                "2017-10-17\n" +
                "2017-10-18\n" +
                "2017-10-19\n" +
                "2017-10-20\n" +
                "2017-10-23\n" +
                "2017-10-24\n" +
                "2017-10-25\n" +
                "2017-10-26\n" +
                "2017-10-27\n" +
                "2017-10-30\n" +
                "2017-10-31\n" +
                "2017-11-01\n" +
                "2017-11-02\n" +
                "2017-11-03\n" +
                "2017-11-06\n" +
                "2017-11-07\n" +
                "2017-11-08\n" +
                "2017-11-09\n" +
                "2017-11-10\n" +
                "2017-11-13\n" +
                "2017-11-14\n" +
                "2017-11-15\n" +
                "2017-11-16\n" +
                "2017-11-17\n" +
                "2017-11-20\n" +
                "2017-11-21\n" +
                "2017-11-22\n" +
                "2017-11-23\n" +
                "2017-11-24\n" +
                "2017-11-27\n" +
                "2017-11-28\n" +
                "2017-11-29\n" +
                "2017-11-30\n" +
                "2017-12-01\n" +
                "2017-12-04\n" +
                "2017-12-05\n" +
                "2017-12-06\n" +
                "2017-12-07\n" +
                "2017-12-08\n" +
                "2017-12-11\n" +
                "2017-12-12\n" +
                "2017-12-13\n" +
                "2017-12-14\n" +
                "2017-12-15\n" +
                "2017-12-18\n" +
                "2017-12-19\n" +
                "2017-12-20\n" +
                "2017-12-21\n" +
                "2017-12-22\n" +
                "2017-12-25\n" +
                "2017-12-26\n" +
                "2017-12-27\n" +
                "2017-12-28\n" +
                "2017-12-29\n" +
                "2018-01-02\n" +
                "2018-01-03\n" +
                "2018-01-04\n" +
                "2018-01-05\n" +
                "2018-01-08\n" +
                "2018-01-09\n" +
                "2018-01-10\n" +
                "2018-01-11\n" +
                "2018-01-12\n" +
                "2018-01-15\n" +
                "2018-01-16\n" +
                "2018-01-17\n" +
                "2018-01-18\n" +
                "2018-01-19\n" +
                "2018-01-22\n" +
                "2018-01-23\n" +
                "2018-01-24\n" +
                "2018-01-25\n" +
                "2018-01-26\n" +
                "2018-01-29\n" +
                "2018-01-30\n" +
                "2018-01-31\n" +
                "2018-02-01\n" +
                "2018-02-02\n" +
                "2018-02-05\n" +
                "2018-02-06\n" +
                "2018-02-07\n" +
                "2018-02-08\n" +
                "2018-02-09\n" +
                "2018-02-12\n" +
                "2018-02-13\n" +
                "2018-02-14\n" +
                "2018-02-22\n" +
                "2018-02-23\n" +
                "2018-02-26\n" +
                "2018-02-27\n" +
                "2018-02-28\n" +
                "2018-03-01\n" +
                "2018-03-02\n" +
                "2018-03-05\n" +
                "2018-03-06\n" +
                "2018-03-07\n" +
                "2018-03-08\n" +
                "2018-03-09\n" +
                "2018-03-12\n" +
                "2018-03-13\n" +
                "2018-03-14\n" +
                "2018-03-15\n" +
                "2018-03-16\n" +
                "2018-03-19\n" +
                "2018-03-20\n" +
                "2018-03-21\n" +
                "2018-03-22\n" +
                "2018-03-23\n" +
                "2018-03-26\n" +
                "2018-03-27\n" +
                "2018-03-28\n" +
                "2018-03-29\n" +
                "2018-03-30\n" +
                "2018-04-02\n" +
                "2018-04-03\n" +
                "2018-04-04\n" +
                "2018-04-09\n" +
                "2018-04-10\n" +
                "2018-04-11\n" +
                "2018-04-12\n" +
                "2018-04-13\n" +
                "2018-04-16\n" +
                "2018-04-17\n" +
                "2018-04-18\n" +
                "2018-04-19\n" +
                "2018-04-20\n" +
                "2018-04-23\n" +
                "2018-04-24\n" +
                "2018-04-25\n" +
                "2018-04-26\n" +
                "2018-04-27\n" +
                "2018-05-03\n" +
                "2018-05-04\n" +
                "2018-05-07\n" +
                "2018-05-08\n" +
                "2018-05-09\n" +
                "2018-05-10\n" +
                "2018-05-11";

        String r = "-0.005012033\n" +
                "-0.051865517\n" +
                "0.114389869\n" +
                "0.082577485\n" +
                "-0.004703761\n" +
                "0.067150352\n" +
                "-0.008186132\n" +
                "-0.021260193\n" +
                "0.015516452\n" +
                "0.06003415\n" +
                "-0.012414539\n" +
                "0.028079702\n" +
                "0.113264636\n" +
                "-0.003668074\n" +
                "0.02997852\n" +
                "-0.067826957\n" +
                "-0.041243004\n" +
                "0.052734459\n" +
                "-0.040157745\n" +
                "0.024262378\n" +
                "-0.051764788\n" +
                "0.109333992\n" +
                "-0.004564656\n" +
                "-0.030911893\n" +
                "0.000286187\n" +
                "-0.062106477\n" +
                "-0.020298172\n" +
                "0.037342832\n" +
                "0.055624499\n" +
                "-0.034137586\n" +
                "0.043710666\n" +
                "0.055916979\n" +
                "-0.077785244\n" +
                "-0.053961612\n" +
                "0.041849538\n" +
                "0.058982193\n" +
                "-0.009044578\n" +
                "-0.019017501\n" +
                "0.049333942\n" +
                "0.050121336\n" +
                "0.021873563\n" +
                "0.022656188\n" +
                "0.026131248\n" +
                "0.055453868\n" +
                "0.104078777\n" +
                "0.05702536\n" +
                "0.072610812\n" +
                "0.043794717\n" +
                "0.007033282\n" +
                "0.034721247\n" +
                "-0.064642914\n" +
                "0.034919742\n" +
                "0.032724048\n" +
                "0.20246395\n" +
                "-0.003130732\n" +
                "0.068155997\n" +
                "-0.062859286\n" +
                "0.156517611\n" +
                "0.074077482\n" +
                "0.05647732\n" +
                "-0.110007843\n" +
                "0.025560962\n" +
                "0.075234495\n" +
                "-0.058104285\n" +
                "-0.055349543\n" +
                "0.127927185\n" +
                "0.059619602\n" +
                "-0.026796641\n" +
                "0.027217058\n" +
                "0.095601603\n" +
                "-0.031541835\n" +
                "0.033944934\n" +
                "0.087790547\n" +
                "0.023612922\n" +
                "-0.05318418\n" +
                "0.026300654\n" +
                "0.069202922\n" +
                "-0.034317858\n" +
                "0.110039785\n" +
                "0.004704021\n" +
                "-0.121870567\n" +
                "-0.021496463\n" +
                "0.094310525\n" +
                "-0.002769463\n" +
                "0.041566752\n" +
                "-0.041846563\n" +
                "-0.064100326\n" +
                "-0.034824978\n" +
                "0.07861397\n" +
                "-0.004372376\n" +
                "0.035207163\n" +
                "-0.032229429\n" +
                "-0.046102498\n" +
                "0.09130344\n" +
                "0.00321705\n" +
                "-0.029482633\n" +
                "-0.020101423\n" +
                "0.077408969\n" +
                "0.057611468\n" +
                "0.014814079\n" +
                "-0.01588737\n" +
                "0.017731523\n" +
                "0.035908649\n" +
                "0.047078613\n" +
                "-0.04344935\n" +
                "-0.006988473\n" +
                "-0.02303461\n" +
                "0.070095917\n" +
                "-0.024548434\n" +
                "0.051193771\n" +
                "-0.007544506\n" +
                "0.010288571\n" +
                "0.035830183\n" +
                "0.096477383\n" +
                "0.070707745\n" +
                "0.072377483\n" +
                "-0.014582281\n" +
                "0.130392779\n" +
                "0.04988804\n" +
                "-0.01221628\n" +
                "0.036393274\n" +
                "-0.005222337\n" +
                "0.079452311\n" +
                "0.099411164\n" +
                "-0.048270308\n" +
                "0.004934153\n" +
                "0.078154933\n" +
                "0.083471756\n" +
                "0.176557029\n" +
                "0.046123893\n" +
                "0.074105097\n" +
                "0.027851666\n" +
                "0.04975192\n" +
                "0.004741675\n" +
                "0.047549261\n" +
                "0.044712173\n" +
                "0.028679016\n" +
                "-0.036697356\n" +
                "0.060950185\n" +
                "0.028867473\n" +
                "0.09972558\n" +
                "-0.020078686\n" +
                "0.071912289\n" +
                "-0.007674782\n" +
                "-0.059988049\n" +
                "-0.013770722\n" +
                "0.025807683\n" +
                "-0.056749537\n" +
                "0.119456725\n" +
                "0.047189213\n" +
                "-0.010797025\n" +
                "-0.01122517\n" +
                "0.012652759\n" +
                "0.010392412\n" +
                "-0.009712546\n" +
                "-0.001110122\n" +
                "0.104879222\n" +
                "-0.027227767\n" +
                "0.012316958\n" +
                "0.002445747\n" +
                "0.035800945\n" +
                "-0.00306448\n" +
                "0.013190385\n" +
                "0.051476299\n" +
                "0.002116638\n" +
                "0.032247528\n" +
                "0.005536609\n" +
                "0.027602367\n" +
                "0.026444164\n" +
                "0.022026737\n" +
                "0.057257883\n" +
                "0.017076034\n" +
                "0.024929689\n" +
                "0.01156616\n" +
                "0.00232422\n" +
                "0.00060677\n" +
                "0.007369426\n" +
                "0.007320169\n" +
                "0.01827509\n" +
                "0.006370988\n" +
                "0.00298475\n" +
                "-0.001868643\n" +
                "0.016795106\n" +
                "0.043808364\n" +
                "0.00983717\n" +
                "-0.027248276\n" +
                "0.020259557\n" +
                "0.029292023\n" +
                "0.086284864\n" +
                "0.044494592\n" +
                "0.009818895\n" +
                "0.097741581\n" +
                "0.031686379\n" +
                "0.001721494\n" +
                "-0.008017779\n" +
                "-0.003639008\n" +
                "0.033681834\n" +
                "0.008729085\n" +
                "0.002603686\n" +
                "-0.006615556\n" +
                "0.006880123\n" +
                "0.03611018\n" +
                "0.040692735\n" +
                "0.003267224\n" +
                "0.013404781\n" +
                "0.018113614\n" +
                "0.016366597\n" +
                "0.025381375\n" +
                "0.005100129\n" +
                "0.021456742\n" +
                "0.021006472\n" +
                "0.036076832\n" +
                "0.032761342\n" +
                "0.016158618\n" +
                "0.016252052\n" +
                "0.015693817\n" +
                "0.055404568\n" +
                "0.03530956\n" +
                "0.010684202\n" +
                "0.038270021\n" +
                "0.057908187\n" +
                "0.052865648\n" +
                "0.070322315\n" +
                "0.019520261\n" +
                "0.045788571\n" +
                "0.01213459\n" +
                "0.010129967\n" +
                "0.015280016\n" +
                "0.040436075\n" +
                "0.01749293\n" +
                "0.010020082\n" +
                "0.04869945\n" +
                "0.032839704\n" +
                "-0.00971192\n" +
                "0.017075735\n" +
                "0.010177211\n" +
                "0.036276217\n" +
                "0.028487392\n" +
                "0.01330902\n" +
                "0.020820773\n" +
                "0.035590616\n" +
                "0.265047737\n" +
                "-0.005106384\n" +
                "-0.023472995\n" +
                "0.046843521\n" +
                "0.01066747\n" +
                "0.078149975\n" +
                "0.077687591\n" +
                "0.080913989\n" +
                "0.165542106\n" +
                "0.152962177\n" +
                "-0.02167062\n" +
                "0.055164025\n" +
                "0.027260702\n" +
                "0.063790642\n" +
                "0.054177896\n" +
                "0.026536027\n" +
                "0.465019631\n" +
                "-0.093714085\n" +
                "0.270090171\n" +
                "-0.041064687\n" +
                "0.150252159\n" +
                "-0.028996737\n" +
                "-0.039720153\n" +
                "-0.0286255\n" +
                "0.0378 \n" +
                "0.0661 \n" +
                "0.0189 \n" +
                "-0.0189 \n" +
                "-0.0283 \n" +
                "0.0112 \n" +
                "0.0234";

        String[] ss = d.split("\\n");
        String[] rr = r.split("\\n");
        String sql = "insert into fund_portfolio_rate(fund_portfolio_rate_id,portfolio_code,nav_date,rate) values('%s','%s','%s','%s');";
        for (int i=0,len=ss.length;i<len;i++) {
            String sql1 = String.format(sql,guidCreater.getUniqueID(),"TEST007",ss[i],rr[i]);
            System.out.println(sql1);
        }

    }

    @Test
    public void tetsPageAvailablePlanByRunDate() {

        List<PlanInfoDO> list = planService.pageAvailablePlanByRunDate(new DateTime("2018-05-18").toDate(),1,1);

        Assert.assertTrue(CollectionUtils.isNotEmpty(list));
    }

}